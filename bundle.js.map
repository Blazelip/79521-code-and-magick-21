{"version":3,"sources":["webpack://code-and-magick/./js/game.js","webpack://code-and-magick/./js/util.js","webpack://code-and-magick/./js/backend.js","webpack://code-and-magick/./js/modal.js","webpack://code-and-magick/./js/stat.js","webpack://code-and-magick/./js/similar.js","webpack://code-and-magick/./js/customize.js","webpack://code-and-magick/./js/render.js","webpack://code-and-magick/./js/avatar.js"],"names":["window","GameConstants","Fireball","size","fireballSize","speed","getFireballSpeed","movingLeft","Wizard","wizardSpeed","width","wizardWidth","getHeight","getWizardHeight","getX","getWizardX","getY","getWizardY","height","Game","HEIGHT","WIDTH","NAMES","SpriteMap","REVERSED","url","ObjectsBehaviour","object","state","timeframe","keysPressed","UP","y","direction","LEFT","x","RIGHT","_state","Verdict","CONTINUE","WIN","FAIL","PAUSE","INTRO","LevelsRules","garbage","filter","type","fireball","LevelsInitialize","objects","push","sprite","container","this","canvas","document","createElement","clientWidth","clientHeight","appendChild","ctx","getContext","_onKeyDown","bind","_onKeyUp","_pauseListener","setDeactivated","prototype","level","deactivated","_deactivated","_removeGameListeners","_initializeGameListeners","getInitialState","currentStatus","lastUpdated","ESC","SPACE","levelStartTime","startTime","initializeLevelAndStart","restart","_imagesArePreloaded","Date","now","_preloadImagesForLevel","render","update","pauseLevel","verdict","addEventListener","_drawPauseScreen","evt","keyCode","preventDefault","needToRestartTheGame","removeEventListener","message","renderStatistics","statistics","_generateStatistics","keys","_shuffleArray","Object","map","it","_drawMessage","time","statistic","i","length","userTime","Math","random","generationIntervalSec","array","j","floor","temp","drawCloud","heigth","beginPath","moveTo","lineTo","stroke","closePath","fill","fillStyle","font","split","forEach","line","fillText","callback","imagesToGo","self","loadSprite","image","Image","onload","src","updateObjects","delta","me","SHIFT","remainingObjects","checkStatus","commonRules","allChecks","concat","currentCheck","shift","currentRule","setGameStatus","status","clearRect","reversed","drawImage","requestAnimationFrame","shiftKey","game","querySelector","restartGame","wizardRightImage","wizardLeftImage","util","getRandomArrayIndex","getPartOfArray","endPoint","copiedArray","slice","shuffleArray","getMaxElement","arr","maxElement","showErrorMessage","errorMessage","node","style","position","left","right","fontSize","textContent","body","insertAdjacentElement","debounce","cb","interval","lastTimeout","parameters","clearTimeout","setTimeout","API_URL","getServerResponse","xhr","onLoad","onError","response","statusText","timeout","backend","download","XMLHttpRequest","responseType","open","send","upload","data","setupBlock","setupForm","modalHandle","setupPlayer","setupNameInput","setupOpen","setupOpenIcon","setupClose","openPopup","classList","remove","similar","onSuccessLoadData","onFailedRequest","onPopupEscPress","onPopupCloseBtnEnter","customize","onWizzardSetSettings","closePopup","add","key","activeElement","onSuccessSendForm","startCoords","clientX","clientY","dragged","onMouseMove","moveEvt","top","offsetTop","offsetLeft","onMouseUp","upEvt","onClickPreventDefault","clickEvt","FormData","FONT_COLOR","renderCloud","color","fillRect","players","times","CLOUD_START_X","CLOUD_START_Y","textBaseline","maxTime","currentPosX","currentBarHeight","CLOUD_HEIGHT","round","GAP_NICKNAME","serverData","sourceData","sortWizardsData","COAT_COLORS","EYES_COLORS","FIREBALL_COLORS","coatColor","eyesColor","setupCoatColorInput","setupEyesColorInput","setupFireballColorInput","wizardCoat","wizardEyes","fireballColor","getRank","wizard","rank","colorCoat","colorEyes","renderWizards","sort","rankDiff","namesComparator","name","getItemColor","input","currentColor","value","newColor","valueLength","target","setCustomValidity","reportValidity","newCoatColor","newEyesColor","newFireballColor","backgroundColor","setupSimilarList","setupSimilarBlock","wizardTemplate","getElementById","content","createWizard","wizardData","element","cloneNode","wizardsArray","fragment","createDocumentFragment","takeNumber","innerHTML","currentWizard","FILE_TYPES","fileChooser","preview","file","files","fileType","some","item","endsWith","reader","FileReader","result","readAsDataURL"],"mappings":"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","file":"bundle.js","sourcesContent":["'use strict';\n\nwindow.GameConstants = {\n  Fireball: {\n    size: fireballSize || 24,\n    speed: getFireballSpeed || function (movingLeft) {\n      return movingLeft ? 2 : 5;\n    }\n  },\n  Wizard: {\n    speed: wizardSpeed || 2,\n    width: wizardWidth || 61,\n    getHeight: getWizardHeight || function (width) {\n      return 1.377 * width;\n    },\n    getX: getWizardX || function (width) {\n      return width / 3;\n    },\n    getY: getWizardY || function (height) {\n      return height - 100;\n    }\n  }\n};\n\nwindow.Game = (function () {\n  /**\n   * @const\n   * @type {number}\n   */\n  var HEIGHT = 300;\n\n  /**\n   * @const\n   * @type {number}\n   */\n  var WIDTH = 700;\n\n  /**\n   * ID уровней.\n   * @enum {number}\n   */\n  var Level = {\n    INTRO: 0,\n    MOVE_LEFT: 1,\n    MOVE_RIGHT: 2,\n    LEVITATE: 3,\n    HIT_THE_MARK: 4\n  };\n\n  var NAMES = ['Кекс', 'Катя', 'Игорь'];\n\n  /**\n   * Порядок прохождения уровней.\n   * @type {Array.<Level>}\n   */\n  var LevelSequence = [\n    Level.INTRO\n  ];\n\n  /**\n   * Начальный уровень.\n   * @type {Level}\n   */\n  var INITIAL_LEVEL = LevelSequence[0];\n\n  /**\n   * Допустимые виды объектов на карте.\n   * @enum {number}\n   */\n  var ObjectType = {\n    ME: 0,\n    FIREBALL: 1\n  };\n\n  /**\n   * Допустимые состояния объектов.\n   * @enum {number}\n   */\n  var ObjectState = {\n    OK: 0,\n    DISPOSED: 1\n  };\n\n  /**\n   * Коды направлений.\n   * @enum {number}\n   */\n  var Direction = {\n    NULL: 0,\n    LEFT: 1,\n    RIGHT: 2,\n    UP: 4,\n    DOWN: 8\n  };\n\n  /**\n   * Карта спрайтов игры.\n   * @type {Object.<ObjectType, Object>}\n   */\n  var SpriteMap = {};\n  var REVERSED = '-reversed';\n\n  SpriteMap[ObjectType.ME] = {\n    width: 61,\n    height: 84,\n    url: 'img/wizard.gif'\n  };\n\n  // TODO: Find a clever way\n  SpriteMap[ObjectType.ME + REVERSED] = {\n    width: 61,\n    height: 84,\n    url: 'img/wizard-reversed.gif'\n  };\n\n  SpriteMap[ObjectType.FIREBALL] = {\n    width: 24,\n    height: 24,\n    url: 'img/fireball.gif'\n  };\n\n  /**\n   * Правила перерисовки объектов в зависимости от состояния игры.\n   * @type {Object.<ObjectType, function(Object, Object, number): Object>}\n   */\n  var ObjectsBehaviour = {};\n\n  /**\n   * Обновление движения мага. Движение мага зависит от нажатых в данный момент\n   * стрелок. Маг может двигаться одновременно по горизонтали и по вертикали.\n   * На движение мага влияет его пересечение с препятствиями.\n   * @param {Object} object\n   * @param {Object} state\n   * @param {number} timeframe\n   */\n  ObjectsBehaviour[ObjectType.ME] = function (object, state, timeframe) {\n    // Пока зажата стрелка вверх, маг сначала поднимается, а потом левитирует\n    // в воздухе на определенной высоте.\n    // NB! Сложность заключается в том, что поведение описано в координатах\n    // канваса, а не координатах, относительно нижней границы игры.\n    if (state.keysPressed.UP && object.y > 0) {\n      object.direction = object.direction & ~Direction.DOWN;\n      object.direction = object.direction | Direction.UP;\n      object.y -= object.speed * timeframe * 2;\n    }\n\n    // Если стрелка вверх не зажата, а маг находится в воздухе, он плавно\n    // опускается на землю.\n    if (!state.keysPressed.UP) {\n      if (object.y < HEIGHT - object.height) {\n        object.direction = object.direction & ~Direction.UP;\n        object.direction = object.direction | Direction.DOWN;\n        object.y += object.speed * timeframe / 3;\n      }\n    }\n\n    // Если зажата стрелка влево, маг перемещается влево.\n    if (state.keysPressed.LEFT) {\n      object.direction = object.direction & ~Direction.RIGHT;\n      object.direction = object.direction | Direction.LEFT;\n      object.x -= object.speed * timeframe;\n    }\n\n    // Если зажата стрелка вправо, маг перемещается вправо.\n    if (state.keysPressed.RIGHT) {\n      object.direction = object.direction & ~Direction.LEFT;\n      object.direction = object.direction | Direction.RIGHT;\n      object.x += object.speed * timeframe;\n    }\n\n    // Ограничения по перемещению по полю. Маг не может выйти за пределы поля.\n    if (object.y < 0) {\n      object.y = 0;\n    }\n\n    if (object.y > HEIGHT - object.height) {\n      object.y = HEIGHT - object.height;\n    }\n\n    if (object.x < 0) {\n      object.x = 0;\n    }\n\n    if (object.x > WIDTH - object.width) {\n      object.x = WIDTH - object.width;\n    }\n  };\n\n  /**\n   * Обновление движения файрбола. Файрбол выпускается в определенном направлении\n   * и после этого неуправляемо движется по прямой в заданном направлении. Если\n   * он пролетает весь экран насквозь, он исчезает.\n   * @param {Object} object\n   * @param {Object} _state\n   * @param {number} timeframe\n   */\n  ObjectsBehaviour[ObjectType.FIREBALL] = function (object, _state, timeframe) {\n    if (object.direction & Direction.LEFT) {\n      object.x -= object.speed * timeframe;\n    }\n\n    if (object.direction & Direction.RIGHT) {\n      object.x += object.speed * timeframe;\n    }\n\n    if (object.x < 0 || object.x > WIDTH) {\n      object.state = ObjectState.DISPOSED;\n    }\n  };\n\n  /**\n   * ID возможных ответов функций, проверяющих успех прохождения уровня.\n   * CONTINUE говорит о том, что раунд не закончен и игру нужно продолжать,\n   * WIN о том, что раунд выигран, FAIL — о поражении. PAUSE о том, что игру\n   * нужно прервать.\n   * @enum {number}\n   */\n  var Verdict = {\n    CONTINUE: 0,\n    WIN: 1,\n    FAIL: 2,\n    PAUSE: 3,\n    INTRO: 4\n  };\n\n  /**\n   * Правила завершения уровня. Ключами служат ID уровней, значениями функции\n   * принимающие на вход состояние уровня и возвращающие true, если раунд\n   * можно завершать или false если нет.\n   * @type {Object.<Level, function(Object):boolean>}\n   */\n  var LevelsRules = {};\n\n  /**\n   * Уровень считается пройденным, если был выпущен файлболл и он улетел\n   * за экран.\n   * @param {Object} state\n   * @return {Verdict}\n   */\n  LevelsRules[Level.INTRO] = function (state) {\n    var deletedFireballs = state.garbage.filter(function (object) {\n      return object.type === ObjectType.FIREBALL;\n    });\n\n    var fenceHit = deletedFireballs.filter(function (fireball) {\n      // Did we hit the fence?\n      return fireball.x < 10 && fireball.y > 240;\n    })[0];\n\n    return fenceHit ? Verdict.WIN : Verdict.CONTINUE;\n  };\n\n  /**\n   * Начальные условия для уровней.\n   * @enum {Object.<Level, function>}\n   */\n  var LevelsInitialize = {};\n\n  /**\n   * Первый уровень.\n   * @param {Object} state\n   * @return {Object}\n   */\n  LevelsInitialize[Level.INTRO] = function (state) {\n    state.objects.push(\n        // Установка персонажа в начальное положение. Он стоит в крайнем левом\n        // углу экрана, глядя вправо. Скорость перемещения персонажа на этом\n        // уровне равна 2px за кадр.\n        {\n          direction: Direction.RIGHT,\n          height: window.GameConstants.Wizard.getHeight(window.GameConstants.Wizard.width),\n          speed: window.GameConstants.Wizard.speed,\n          sprite: SpriteMap[ObjectType.ME],\n          state: ObjectState.OK,\n          type: ObjectType.ME,\n          width: window.GameConstants.Wizard.width,\n          x: window.GameConstants.Wizard.getX(WIDTH),\n          y: window.GameConstants.Wizard.getY(HEIGHT)\n        }\n    );\n\n    return state;\n  };\n\n  /**\n   * Конструктор объекта Game. Создает canvas, добавляет обработчики событий\n   * и показывает приветственный экран.\n   * @param {Element} container\n   * @constructor\n   */\n  var Game = function (container) {\n    this.container = container;\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = container.clientWidth;\n    this.canvas.height = container.clientHeight;\n    this.container.appendChild(this.canvas);\n\n    this.ctx = this.canvas.getContext('2d');\n\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._onKeyUp = this._onKeyUp.bind(this);\n    this._pauseListener = this._pauseListener.bind(this);\n\n    this.setDeactivated(false);\n  };\n\n  Game.prototype = {\n    /**\n     * Текущий уровень игры.\n     * @type {Level}\n     */\n    level: INITIAL_LEVEL,\n\n    /** @param {boolean} deactivated */\n    setDeactivated: function (deactivated) {\n      if (this._deactivated === deactivated) {\n        return;\n      }\n\n      this._deactivated = deactivated;\n\n      if (deactivated) {\n        this._removeGameListeners();\n      } else {\n        this._initializeGameListeners();\n      }\n    },\n\n    /**\n     * Состояние игры. Описывает местоположение всех объектов на игровой карте\n     * и время проведенное на уровне и в игре.\n     * @return {Object}\n     */\n    getInitialState: function () {\n      return {\n        // Статус игры. Если CONTINUE, то игра продолжается.\n        currentStatus: Verdict.CONTINUE,\n\n        // Объекты, удаленные на последнем кадре.\n        garbage: [],\n\n        // Время с момента отрисовки предыдущего кадра.\n        lastUpdated: null,\n\n        // Состояние нажатых клавиш.\n        keysPressed: {\n          ESC: false,\n          LEFT: false,\n          RIGHT: false,\n          SPACE: false,\n          UP: false\n        },\n\n        // Время начала прохождения уровня.\n        levelStartTime: null,\n\n        // Все объекты на карте.\n        objects: [],\n\n        // Время начала прохождения игры.\n        startTime: null\n      };\n    },\n\n    /**\n     * Начальные проверки и запуск текущего уровня.\n     * @param {boolean=} restart\n     */\n    initializeLevelAndStart: function (restart) {\n      restart = typeof restart === 'undefined' ? true : restart;\n\n      if (restart || !this.state) {\n        // сбросить кэш при перезагрузке уровня\n        this._imagesArePreloaded = void 0;\n\n        // При перезапуске уровня, происходит полная перезапись состояния\n        // игры из изначального состояния.\n        this.state = this.getInitialState();\n        this.state = LevelsInitialize[this.level](this.state);\n      } else {\n        // При продолжении уровня состояние сохраняется, кроме записи о том,\n        // что состояние уровня изменилось с паузы на продолжение игры.\n        this.state.currentStatus = Verdict.CONTINUE;\n      }\n\n      // Запись времени начала игры и времени начала уровня.\n      this.state.levelStartTime = Date.now();\n      if (!this.state.startTime) {\n        this.state.startTime = this.state.levelStartTime;\n      }\n\n      this._preloadImagesForLevel(function () {\n        // Предварительная отрисовка игрового экрана.\n        this.render();\n\n        // Установка обработчиков событий.\n        this._initializeGameListeners();\n\n        // Запуск игрового цикла.\n        this.update();\n      }.bind(this));\n    },\n\n    /**\n     * Временная остановка игры.\n     * @param {Verdict=} verdict\n     */\n    pauseLevel: function (verdict) {\n      if (verdict) {\n        this.state.currentStatus = verdict;\n      }\n\n      this.state.keysPressed.ESC = false;\n      this.state.lastUpdated = null;\n\n      this._removeGameListeners();\n      window.addEventListener('keydown', this._pauseListener);\n\n      this._drawPauseScreen();\n    },\n\n    /**\n     * Обработчик событий клавиатуры во время паузы.\n     * @param {KeyboardsEvent} evt\n     * @private\n     * @private\n     */\n    _pauseListener: function (evt) {\n      if (evt.keyCode === 32 && !this._deactivated) {\n        evt.preventDefault();\n        var needToRestartTheGame = this.state.currentStatus === Verdict.WIN ||\n          this.state.currentStatus === Verdict.FAIL;\n        this.initializeLevelAndStart(needToRestartTheGame);\n\n        window.removeEventListener('keydown', this._pauseListener);\n      }\n    },\n\n    /**\n     * Отрисовка экрана паузы.\n     */\n    _drawPauseScreen: function () {\n      var message;\n      switch (this.state.currentStatus) {\n        case Verdict.WIN:\n          if (window.renderStatistics) {\n            var statistics = this._generateStatistics(new Date() - this.state.startTime);\n            var keys = this._shuffleArray(Object.keys(statistics));\n            window.renderStatistics(this.ctx, keys, keys.map(function (it) {\n              return statistics[it];\n            }));\n            return;\n          }\n          message = 'Вы победили Газебо!\\nУра!';\n          break;\n        case Verdict.FAIL:\n          message = 'Вы проиграли!';\n          break;\n        case Verdict.PAUSE:\n          message = 'Игра на паузе!\\nНажмите Пробел, чтобы продолжить';\n          break;\n        case Verdict.INTRO:\n          message = 'Добро пожаловать!\\nНажмите Пробел для начала игры';\n          break;\n      }\n\n      this._drawMessage(message);\n    },\n\n    _generateStatistics: function (time) {\n      var generationIntervalSec = 3000;\n      var minTimeInSec = 1000;\n\n      var statistic = {\n        'Вы': time\n      };\n\n      for (var i = 0; i < NAMES.length; i++) {\n        var diffTime = Math.random() * generationIntervalSec;\n        var userTime = time + (diffTime - generationIntervalSec / 2);\n        if (userTime < minTimeInSec) {\n          userTime = minTimeInSec;\n        }\n        statistic[NAMES[i]] = userTime;\n      }\n\n      return statistic;\n    },\n\n    _shuffleArray: function (array) {\n      for (var i = array.length - 1; i > 0; i--) {\n        var j = Math.floor(Math.random() * (i + 1));\n        var temp = array[i];\n        array[i] = array[j];\n        array[j] = temp;\n      }\n      return array;\n    },\n\n    _drawMessage: function (message) {\n      var ctx = this.ctx;\n\n      var drawCloud = function (x, y, width, heigth) {\n        var offset = 10;\n        ctx.beginPath();\n        ctx.moveTo(x, y);\n        ctx.lineTo(x + offset, y + heigth / 2);\n        ctx.lineTo(x, y + heigth);\n        ctx.lineTo(x + width / 2, y + heigth - offset);\n        ctx.lineTo(x + width, y + heigth);\n        ctx.lineTo(x + width - offset, y + heigth / 2);\n        ctx.lineTo(x + width, y);\n        ctx.lineTo(x + width / 2, y + offset);\n        ctx.lineTo(x, y);\n        ctx.stroke();\n        ctx.closePath();\n        ctx.fill();\n      };\n\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n      drawCloud(190, 40, 320, 100);\n\n      ctx.fillStyle = 'rgba(256, 256, 256, 1.0)';\n      drawCloud(180, 30, 320, 100);\n\n      ctx.fillStyle = '#000';\n      ctx.font = '16px PT Mono';\n      message.split('\\n').forEach(function (line, i) {\n        ctx.fillText(line, 200, 80 + 20 * i);\n      });\n    },\n\n    /**\n     * Предзагрузка необходимых изображений для уровня.\n     * @param {function} callback\n     * @private\n     */\n    _preloadImagesForLevel: function (callback) {\n      if (typeof this._imagesArePreloaded === 'undefined') {\n        this._imagesArePreloaded = [];\n      }\n\n      if (this._imagesArePreloaded[this.level]) {\n        callback();\n        return;\n      }\n\n      var keys = Object.keys(SpriteMap);\n      var imagesToGo = keys.length;\n\n      var self = this;\n\n      var loadSprite = function (sprite) {\n        var image = new Image(sprite.width, sprite.height);\n        image.onload = function () {\n          sprite.image = image;\n          if (--imagesToGo === 0) {\n            self._imagesArePreloaded[self.level] = true;\n            callback();\n          }\n        };\n        image.src = sprite.url;\n      };\n\n      for (var i = 0; i < keys.length; i++) {\n        loadSprite(SpriteMap[keys[i]]);\n      }\n    },\n\n    /**\n     * Обновление статуса объектов на экране. Добавляет объекты, которые должны\n     * появиться, выполняет проверку поведения всех объектов и удаляет те, которые\n     * должны исчезнуть.\n     * @param {number} delta Время, прошеднее с отрисовки прошлого кадра.\n     */\n    updateObjects: function (delta) {\n      // Персонаж.\n      var me = this.state.objects.filter(function (object) {\n        return object.type === ObjectType.ME;\n      })[0];\n\n      // Добавляет на карту файрбол по нажатию на Shift.\n      if (this.state.keysPressed.SHIFT) {\n        this.state.objects.push({\n          direction: me.direction,\n          height: window.GameConstants.Fireball.size,\n          speed: window.GameConstants.Fireball.speed(!!(me.direction & Direction.LEFT)),\n          sprite: SpriteMap[ObjectType.FIREBALL],\n          type: ObjectType.FIREBALL,\n          width: window.GameConstants.Fireball.size,\n          x: me.direction & Direction.RIGHT ? me.x + me.width : me.x - window.GameConstants.Fireball.size,\n          y: me.y + me.height / 2\n        });\n\n        this.state.keysPressed.SHIFT = false;\n      }\n\n      this.state.garbage = [];\n\n      // Убирает в garbage не используемые на карте объекты.\n      var remainingObjects = this.state.objects.filter(function (object) {\n        ObjectsBehaviour[object.type](object, this.state, delta);\n\n        if (object.state === ObjectState.DISPOSED) {\n          this.state.garbage.push(object);\n          return false;\n        }\n\n        return true;\n      }, this);\n\n      this.state.objects = remainingObjects;\n    },\n\n    /**\n     * Проверка статуса текущего уровня.\n     */\n    checkStatus: function () {\n      // Нет нужны запускать проверку, нужно ли останавливать уровень, если\n      // заранее известно, что да.\n      if (this.state.currentStatus !== Verdict.CONTINUE) {\n        return;\n      }\n\n      if (!this.commonRules) {\n        // Проверки, не зависящие от уровня, но влияющие на его состояние.\n        this.commonRules = [\n\n          /**\n           * Если персонаж мертв, игра прекращается.\n           * @param {Object} state\n           * @return {Verdict}\n           */\n          function (state) {\n            var me = state.objects.filter(function (object) {\n              return object.type === ObjectType.ME;\n            })[0];\n\n            return me.state === ObjectState.DISPOSED ?\n              Verdict.FAIL :\n              Verdict.CONTINUE;\n          },\n\n          /**\n           * Если нажата клавиша Esc игра ставится на паузу.\n           * @param {Object} state\n           * @return {Verdict}\n           */\n          function (state) {\n            return state.keysPressed.ESC ? Verdict.PAUSE : Verdict.CONTINUE;\n          },\n\n          /**\n           * Игра прекращается если игрок продолжает играть в нее два часа подряд.\n           * @param {Object} state\n           * @return {Verdict}\n           */\n          function (state) {\n            return Date.now() - state.startTime > 3 * 60 * 1000 ?\n              Verdict.FAIL :\n              Verdict.CONTINUE;\n          }\n        ];\n      }\n\n      // Проверка всех правил влияющих на уровень. Запускаем цикл проверок\n      // по всем универсальным проверкам и проверкам конкретного уровня.\n      // Цикл продолжается до тех пор, пока какая-либо из проверок не вернет\n      // любое другое состояние кроме CONTINUE или пока не пройдут все\n      // проверки. После этого состояние сохраняется.\n      var allChecks = this.commonRules.concat(LevelsRules[this.level]);\n      var currentCheck = Verdict.CONTINUE;\n      var currentRule;\n\n      while (currentCheck === Verdict.CONTINUE && allChecks.length) {\n        currentRule = allChecks.shift();\n        currentCheck = currentRule(this.state);\n      }\n\n      this.state.currentStatus = currentCheck;\n    },\n\n    /**\n     * Принудительная установка состояния игры. Используется для изменения\n     * состояния игры от внешних условий, например, когда необходимо остановить\n     * игру, если она находится вне области видимости и установить вводный\n     * экран.\n     * @param {Verdict} status\n     */\n    setGameStatus: function (status) {\n      if (this.state.currentStatus !== status) {\n        this.state.currentStatus = status;\n      }\n    },\n\n    /**\n     * Отрисовка всех объектов на экране.\n     */\n    render: function () {\n      // Удаление всех отрисованных на странице элементов.\n      this.ctx.clearRect(0, 0, WIDTH, HEIGHT);\n\n      // Выставление всех элементов, оставшихся в this.state.objects согласно\n      // их координатам и направлению.\n      this.state.objects.forEach(function (object) {\n        if (object.sprite) {\n          var reversed = object.direction & Direction.LEFT;\n          var sprite = SpriteMap[object.type + (reversed ? REVERSED : '')] || SpriteMap[object.type];\n          this.ctx.drawImage(sprite.image, object.x, object.y, object.width, object.height);\n        }\n      }, this);\n    },\n\n    /**\n     * Основной игровой цикл. Сначала проверяет состояние всех объектов игры\n     * и обновляет их согласно правилам их поведения, а затем запускает\n     * проверку текущего раунда. Рекурсивно продолжается до тех пор, пока\n     * проверка не вернет состояние FAIL, WIN или PAUSE.\n     */\n    update: function () {\n      if (!this.state.lastUpdated) {\n        this.state.lastUpdated = Date.now();\n      }\n\n      var delta = (Date.now() - this.state.lastUpdated) / 10;\n      this.updateObjects(delta);\n      this.checkStatus();\n\n      switch (this.state.currentStatus) {\n        case Verdict.CONTINUE:\n          this.state.lastUpdated = Date.now();\n          this.render();\n          requestAnimationFrame(function () {\n            this.update();\n          }.bind(this));\n          break;\n\n        case Verdict.WIN:\n        case Verdict.FAIL:\n        case Verdict.PAUSE:\n        case Verdict.INTRO:\n          this.pauseLevel();\n          break;\n      }\n    },\n\n    /**\n     * @param {KeyboardEvent} evt [description]\n     * @private\n     */\n    _onKeyDown: function (evt) {\n      switch (evt.keyCode) {\n        case 37:\n          this.state.keysPressed.LEFT = true;\n          break;\n        case 39:\n          this.state.keysPressed.RIGHT = true;\n          break;\n        case 38:\n          this.state.keysPressed.UP = true;\n          break;\n        case 27:\n          this.state.keysPressed.ESC = true;\n          break;\n      }\n\n      if (evt.shiftKey) {\n        this.state.keysPressed.SHIFT = true;\n      }\n    },\n\n    /**\n     * @param {KeyboardEvent} evt [description]\n     * @private\n     */\n    _onKeyUp: function (evt) {\n      switch (evt.keyCode) {\n        case 37:\n          this.state.keysPressed.LEFT = false;\n          break;\n        case 39:\n          this.state.keysPressed.RIGHT = false;\n          break;\n        case 38:\n          this.state.keysPressed.UP = false;\n          break;\n        case 27:\n          this.state.keysPressed.ESC = false;\n          break;\n      }\n\n      if (evt.shiftKey) {\n        this.state.keysPressed.SHIFT = false;\n      }\n    },\n\n    /** @private */\n    _initializeGameListeners: function () {\n      window.addEventListener('keydown', this._onKeyDown);\n      window.addEventListener('keyup', this._onKeyUp);\n    },\n\n    /** @private */\n    _removeGameListeners: function () {\n      window.removeEventListener('keydown', this._onKeyDown);\n      window.removeEventListener('keyup', this._onKeyUp);\n    }\n  };\n\n  Game.Verdict = Verdict;\n\n  var game = new Game(document.querySelector('.demo'));\n\n  window.restartGame = function (wizardRightImage, wizardLeftImage) {\n    SpriteMap[ObjectType.ME].url = wizardRightImage;\n    SpriteMap[ObjectType.ME + REVERSED].url = wizardLeftImage;\n\n    game.initializeLevelAndStart();\n    game.setGameStatus(Verdict.INTRO);\n  };\n\n  window.restartGame('img/wizard.gif', 'img/wizard-reversed.gif');\n\n  return game;\n})();\n","'use strict';\n\nconst DEBOUNCE_INTERVAL = 250;\n\nconst getRandomArrayIndex = (array) => {\n  return array[Math.floor(Math.random() * array.length)];\n};\n\nconst getMaxElement = function (arr) {\n  let maxElement = arr[0];\n\n  for (let i = 1; i < arr.length; i++) {\n    if (arr[i] > maxElement) {\n      maxElement = arr[i];\n    }\n  }\n\n  return maxElement;\n};\n\nconst shuffleArray = (array) => {\n  const copiedArray = array.slice();\n\n  for (let i = copiedArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    const temp = copiedArray[i];\n    copiedArray[i] = copiedArray[j];\n    copiedArray[j] = temp;\n  }\n\n  return copiedArray;\n};\n\nconst getPartOfArray = (array, endPoint) => {\n  return shuffleArray(array).slice(0, endPoint);\n};\n\nconst showErrorMessage = (errorMessage) => {\n  const node = document.createElement(`div`);\n  node.style = `z-index: 100; margin: 0 auto; text-align: center; background-color: red;`;\n  node.style.position = `absolute`;\n  node.style.left = 0;\n  node.style.right = 0;\n  node.style.fontSize = `30px`;\n\n  node.textContent = errorMessage;\n  document.body.insertAdjacentElement(`afterbegin`, node);\n};\n\nconst debounce = (cb, interval = DEBOUNCE_INTERVAL) => {\n  let lastTimeout = null;\n\n  return function (...parameters) {\n    if (lastTimeout) {\n      window.clearTimeout(lastTimeout);\n    }\n    lastTimeout = window.setTimeout(function () {\n      cb(...parameters);\n    }, interval);\n  };\n};\n\nwindow.util = {\n  getRandomArrayIndex,\n  getPartOfArray,\n  getMaxElement,\n  showErrorMessage,\n  debounce\n};\n","'use strict';\n\nconst API_URL = `https://javascript.pages.academy/code-and-magick`;\n\nconst TIMEOUT_IN_MS = 10000;\n\nconst StatusCode = {\n  OK: 200\n};\n\nconst getServerResponse = (xhr, onLoad, onError) => {\n  xhr.addEventListener(`load`, () => {\n    if (xhr.status === StatusCode.OK) {\n      onLoad(xhr.response);\n    } else {\n      onError(`Статус ответа: ${xhr.status} - ${xhr.statusText}`);\n    }\n  });\n\n  xhr.addEventListener(`error`, function () {\n    onError(`Произошла ошибка соединения`);\n  });\n  xhr.addEventListener(`timeout`, function () {\n    onError(`Запрос не успел выполниться за ${xhr.timeout} мс`);\n  });\n\n  xhr.timeout = TIMEOUT_IN_MS;\n};\n\nconst download = (onLoad, onError) => {\n  const xhr = new XMLHttpRequest();\n  xhr.responseType = `json`;\n\n  getServerResponse(xhr, onLoad, onError);\n\n  xhr.open(`GET`, `${API_URL}/data`);\n  xhr.send();\n};\n\nconst upload = (data, onLoad, onError) => {\n  const xhr = new XMLHttpRequest();\n  xhr.responseType = `json`;\n\n  getServerResponse(xhr, onLoad, onError);\n\n  xhr.open(`POST`, API_URL);\n  xhr.send(data);\n};\n\nwindow.backend = {\n  download,\n  upload\n};\n","'use strict';\n\nconst setupBlock = document.querySelector(`.setup`);\nconst setupForm = setupBlock.querySelector(`.setup-wizard-form`);\nconst modalHandle = setupBlock.querySelector(`.upload`);\nconst setupPlayer = setupBlock.querySelector(`.setup-player`);\nconst setupNameInput = setupBlock.querySelector(`.setup-user-name`);\nconst setupOpen = document.querySelector(`.setup-open`);\nconst setupOpenIcon = setupOpen.querySelector(`.setup-open-icon`);\nconst setupClose = setupBlock.querySelector(`.setup-close`);\n\nconst openPopup = () => {\n  setupBlock.classList.remove(`hidden`);\n  window.backend.download(window.similar.onSuccessLoadData, window.similar.onFailedRequest);\n\n  document.addEventListener(`keydown`, onPopupEscPress);\n  setupClose.addEventListener(`keydown`, onPopupCloseBtnEnter);\n  setupPlayer.addEventListener(`click`, window.util.debounce(window.customize.onWizzardSetSettings));\n};\n\nconst closePopup = () => {\n  setupBlock.classList.add(`hidden`);\n\n  document.removeEventListener(`keydown`, onPopupEscPress);\n  setupClose.removeEventListener(`keydown`, onPopupCloseBtnEnter);\n  setupPlayer.removeEventListener(`click`, window.util.debounce(window.customize.onWizzardSetSettings));\n};\n\nconst onPopupEscPress = (evt) => {\n  if (evt.key === `Escape` && document.activeElement !== setupNameInput) {\n    evt.preventDefault();\n    closePopup();\n  }\n};\n\nconst onPopupCloseBtnEnter = (evt) => {\n  if (evt.key === `Enter`) {\n    closePopup();\n  }\n};\n\nconst onSuccessSendForm = () => {\n  setupBlock.classList.add(`hidden`);\n};\n\nsetupOpen.addEventListener(`click`, () => {\n  openPopup();\n});\n\nsetupOpenIcon.addEventListener(`keydown`, (evt) => {\n  if (evt.key === `Enter`) {\n    openPopup();\n  }\n});\n\nsetupClose.addEventListener(`click`, () => {\n  closePopup();\n});\n\nmodalHandle.addEventListener(`mousedown`, function (evt) {\n  evt.preventDefault();\n\n  let startCoords = {\n    x: evt.clientX,\n    y: evt.clientY\n  };\n\n  let dragged = false;\n\n  const onMouseMove = (moveEvt) => {\n    moveEvt.preventDefault();\n\n    dragged = true;\n\n    let shift = {\n      x: startCoords.x - moveEvt.clientX,\n      y: startCoords.y - moveEvt.clientY\n    };\n\n    startCoords = {\n      x: moveEvt.clientX,\n      y: moveEvt.clientY\n    };\n\n    setupBlock.style.top = `${setupBlock.offsetTop - shift.y}px`;\n    setupBlock.style.left = `${setupBlock.offsetLeft - shift.x}px`;\n  };\n\n  const onMouseUp = function (upEvt) {\n    upEvt.preventDefault();\n\n    document.removeEventListener(`mousemove`, onMouseMove);\n    document.removeEventListener(`mouseup`, onMouseUp);\n\n    if (dragged) {\n      const onClickPreventDefault = (clickEvt) => {\n        clickEvt.preventDefault();\n        modalHandle.removeEventListener(`click`, onClickPreventDefault);\n      };\n\n      modalHandle.addEventListener(`click`, onClickPreventDefault);\n    }\n  };\n\n  document.addEventListener(`mousemove`, onMouseMove);\n  document.addEventListener(`mouseup`, onMouseUp);\n});\n\nsetupForm.addEventListener(`submit`, (evt) => {\n  window.backend.upload(new FormData(setupForm), onSuccessSendForm, window.similar.onFailedRequest);\n  evt.preventDefault();\n});\n","'use strict';\n\nconst CLOUD_WIDTH = 420;\nconst CLOUD_HEIGHT = 270;\nconst CLOUD_COLOR = `#ffffff`;\nconst CLOUD_SHADOW_COLOR = `rgba(0, 0, 0, 0.7)`;\nconst CLOUD_START_X = 100;\nconst CLOUD_START_Y = 10;\n\nconst BAR_MAX_HEIGHT = 150;\nconst BAR_WIDTH = 40;\nconst BAR_OWN_COLOR = `rgba(255, 0, 0, 1)`;\n\nconst GAP = 20;\nconst GAP_BAR = 50;\nconst GAP_SHADOW = 10;\nconst GAP_NICKNAME = 10;\nconst GAP_CHART = 40;\n\nconst TEXT_CONGRAT = `Ура вы победили!`;\nconst TEXT_ANNOUNCE_RESULTS = `Список результатов:`;\n\nconst FONT_SIZE = 16;\nconst FONT_COLOR = `#000000`;\nconst LINE_HEIGHT = 20;\n\n\nconst renderCloud = function (ctx, x, y, color) {\n  ctx.fillStyle = color;\n  ctx.fillRect(x, y, CLOUD_WIDTH, CLOUD_HEIGHT);\n};\n\nconst getMaxElement = function (arr) {\n  let maxElement = arr[0];\n\n  for (let i = 1; i < arr.length; i++) {\n    if (arr[i] > maxElement) {\n      maxElement = arr[i];\n    }\n  }\n\n  return maxElement;\n};\n\nconst getBarColor = function (player) {\n  return (player === `Вы`) ? BAR_OWN_COLOR : `hsl(240, ${Math.round(Math.random() * 100)}%, 50%)`;\n};\n\nwindow.renderStatistics = function (ctx, players, times) {\n  renderCloud(ctx, CLOUD_START_X + GAP_SHADOW, CLOUD_START_Y + GAP_SHADOW, CLOUD_SHADOW_COLOR);\n  renderCloud(ctx, CLOUD_START_X, CLOUD_START_Y, CLOUD_COLOR);\n\n  ctx.font = `${FONT_SIZE}px PT Mono`;\n  ctx.fillStyle = FONT_COLOR;\n  ctx.textBaseline = `hanging`;\n  ctx.fillText(TEXT_CONGRAT, CLOUD_START_X + GAP, CLOUD_START_Y + GAP);\n  ctx.fillText(TEXT_ANNOUNCE_RESULTS, CLOUD_START_X + GAP, CLOUD_START_Y + GAP + LINE_HEIGHT);\n\n  const maxTime = getMaxElement(times);\n\n  for (let i = 0; i < players.length; i++) {\n    const currentPosX = CLOUD_START_X + GAP_CHART + (BAR_WIDTH + GAP_BAR) * i;\n    const currentBarHeight = times[i] * BAR_MAX_HEIGHT / maxTime;\n\n    ctx.fillStyle = FONT_COLOR;\n    ctx.fillText(players[i], currentPosX, CLOUD_HEIGHT - GAP);\n    ctx.fillText(Math.round(times[i]), currentPosX, CLOUD_HEIGHT - GAP - currentBarHeight - GAP_NICKNAME * 3);\n\n    ctx.fillStyle = getBarColor(players[i]);\n    ctx.fillRect(currentPosX, CLOUD_HEIGHT - GAP - GAP_NICKNAME, BAR_WIDTH, -currentBarHeight);\n  }\n};\n","'use strict';\n\nconst onSuccessLoadData = (serverData) => {\n  window.sourceData = serverData;\n  window.customize.sortWizardsData(window.sourceData);\n};\n\nconst onFailedRequest = (errorMessage) => {\n  window.util.showErrorMessage(errorMessage);\n};\n\nwindow.similar = {\n  onFailedRequest,\n  onSuccessLoadData\n};\n\n","'use strict';\n\nconst MIN_NAME_LENGTH = 2;\nconst MAX_NAME_LENGTH = 25;\n\nconst COAT_COLORS = [\n  `rgb(101, 137, 164)`,\n  `rgb(241, 43, 107)`,\n  `rgb(146, 100, 161)`,\n  `rgb(56, 159, 117)`,\n  `rgb(215, 210, 55)`,\n  `rgb(0, 0, 0)`\n];\nconst EYES_COLORS = [`black`, `red`, `blue`, `yellow`, `green`];\nconst FIREBALL_COLORS = [`#ee4830`, `#30a8ee`, `#5ce6c0`, `#e848d5`, `#e6e848`];\n\nlet coatColor = `rgb(101, 137, 164)`;\nlet eyesColor = `black`;\n\nconst setupBlock = document.querySelector(`.setup`);\nconst setupPlayer = setupBlock.querySelector(`.setup-player`);\nconst setupNameInput = setupBlock.querySelector(`.setup-user-name`);\nconst setupCoatColorInput = setupPlayer.querySelector(`[name=\"coat-color\"]`);\nconst setupEyesColorInput = setupPlayer.querySelector(`[name=\"eyes-color\"]`);\nconst setupFireballColorInput = setupPlayer.querySelector(`[name=\"fireball-color\"]`);\n\nconst wizardCoat = setupPlayer.querySelector(`.setup-wizard .wizard-coat`);\nconst wizardEyes = setupPlayer.querySelector(`.setup-wizard .wizard-eyes`);\nconst fireballColor = setupPlayer.querySelector(`.setup-fireball`);\n\nconst namesComparator = function (left, right) {\n  if (left > right) {\n    return 1;\n  } else if (left < right) {\n    return -1;\n  } else {\n    return 0;\n  }\n};\n\nconst getRank = (wizard) => {\n  let rank = 0;\n\n  if (wizard.colorCoat === coatColor) {\n    rank += 2;\n  }\n  if (wizard.colorEyes === eyesColor) {\n    rank += 1;\n  }\n\n  return rank;\n};\n\nconst sortWizardsData = (sourceData) => {\n  window.render.renderWizards(sourceData.sort(function (left, right) {\n    let rankDiff = getRank(right) - getRank(left);\n    if (rankDiff === 0) {\n      rankDiff = namesComparator(left.name, right.name);\n    }\n    return rankDiff;\n  }));\n};\n\nconst getItemColor = (input, array) => {\n  const currentColor = input.value;\n  let newColor = window.util.getRandomArrayIndex(array);\n\n  while (newColor === currentColor) {\n    newColor = window.util.getRandomArrayIndex(array);\n  }\n\n  return newColor;\n};\n\nconst onWizzardSetSettings = (evt) => {\n  switch (evt.target) {\n    case wizardCoat:\n      const newCoatColor = getItemColor(setupCoatColorInput, COAT_COLORS);\n      setupCoatColorInput.value = newCoatColor;\n      evt.target.style.fill = newCoatColor;\n      coatColor = newCoatColor;\n      sortWizardsData(window.sourceData);\n      break;\n\n    case wizardEyes:\n      const newEyesColor = getItemColor(setupEyesColorInput, EYES_COLORS);\n\n      setupEyesColorInput.value = newEyesColor;\n      evt.target.style.fill = newEyesColor;\n      eyesColor = newEyesColor;\n      sortWizardsData(window.sourceData);\n      break;\n\n    case fireballColor:\n      const newFireballColor = getItemColor(setupFireballColorInput, FIREBALL_COLORS);\n\n      setupFireballColorInput.value = newFireballColor;\n      evt.target.style.backgroundColor = newFireballColor;\n      break;\n  }\n};\n\nsetupNameInput.addEventListener(`change`, (evt) => {\n  const valueLength = evt.target.value.length;\n\n  if (valueLength < MIN_NAME_LENGTH) {\n    setupNameInput.setCustomValidity(`Ещё ${MIN_NAME_LENGTH - valueLength} симв.`);\n  } else if (valueLength > MAX_NAME_LENGTH) {\n    setupNameInput.setCustomValidity(`Удалите лишние ${valueLength - MAX_NAME_LENGTH} симв.`);\n  } else {\n    setupNameInput.setCustomValidity(``);\n  }\n\n  setupNameInput.reportValidity();\n});\n\nwindow.customize = {\n  onWizzardSetSettings,\n  sortWizardsData\n};\n","'use strict';\n\nconst WIZARDS_AMOUNT = 4;\n\nconst setupBlock = document.querySelector(`.setup`);\nconst setupSimilarList = setupBlock.querySelector(`.setup-similar-list`);\nconst setupSimilarBlock = setupBlock.querySelector(`.setup-similar`);\nconst wizardTemplate = document.getElementById(`similar-wizard-template`)\n  .content\n  .querySelector(`.setup-similar-item`);\n\nconst createWizard = (wizardData) => {\n  const element = wizardTemplate.cloneNode(true);\n\n  element.querySelector(`.setup-similar-label`).textContent = wizardData.name;\n  element.querySelector(`.wizard-coat`).style.fill = wizardData.colorCoat;\n  element.querySelector(`.wizard-eyes`).style.fill = wizardData.colorEyes;\n\n  return element;\n};\n\nconst renderWizards = (wizardsArray) => {\n  const fragment = document.createDocumentFragment();\n  const takeNumber = wizardsArray.length > WIZARDS_AMOUNT ? WIZARDS_AMOUNT : wizardsArray.length;\n\n  setupSimilarList.innerHTML = ``;\n\n  for (let i = 0; i < takeNumber; i++) {\n    const currentWizard = createWizard(wizardsArray[i]);\n    fragment.appendChild(currentWizard);\n  }\n\n  setupSimilarList.appendChild(fragment);\n  setupSimilarBlock.classList.remove(`hidden`);\n};\n\nwindow.render = {\n  renderWizards\n};\n","'use strict';\n\nconst FILE_TYPES = [`jpg`, `jpeg`, `png`];\n\nconst fileChooser = document.querySelector(`.upload input[type=file]`);\nconst preview = document.querySelector(`.setup-user-pic`);\n\nconst onFileInputLoadPic = () => {\n  const file = fileChooser.files[0];\n  const fileType = file.type;\n\n  const matches = FILE_TYPES.some((item) => {\n    return fileType.endsWith(item);\n  });\n\n  if (matches) {\n    const reader = new FileReader();\n\n    reader.addEventListener(`load`, () => {\n      preview.src = reader.result;\n    });\n\n    reader.readAsDataURL(file);\n  }\n};\n\nfileChooser.addEventListener(`change`, onFileInputLoadPic);\n"],"sourceRoot":""}